{% extends 'base.html' %}

{% block title %}Dashboard de Recursos{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <h1 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Dashboard de Recursos</h1>

    <!-- Botones de navegación -->
    <div class="flex justify-center space-x-4 mb-8">
        <a href="{% url 'resources:manage_resources' %}" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Administrar Recursos</a>
        <a href="{% url 'resources:resource_log' %}" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-700 transition">Historial de Recursos</a>
    </div>

    <!-- Resumen de recursos -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="p-6 bg-blue-500 text-white rounded-lg shadow-md">
            <h2 class="text-lg font-semibold">Comida Disponible</h2>
            <p class="text-3xl font-bold mt-2">{{ food_resource.current_quantity }} kg</p>
        </div>
        <div class="p-6 bg-blue-400 text-white rounded-lg shadow-md">
            <h2 class="text-lg font-semibold">Agua Disponible</h2>
            <p class="text-3xl font-bold mt-2">{{ water_resource.current_quantity }} litros</p>
        </div>
    </div>

    <!-- Días estimados -->
    <div class="p-6 bg-green-500 text-white rounded-lg shadow-md mb-8">
        <h2 class="text-lg font-semibold">Días Estimados de Recursos</h2>
        <p class="text-lg mt-2">
            Basado en los datos futuros:
            <br><strong>Días de comida:</strong> {{ days_of_food }} días
            <br><strong>Días de agua:</strong> {{ days_of_water }} días
        </p>
    </div>

    <!-- Gráfico de consumo semanal -->
    <div class="mb-8">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Consumo Estimado de Recursos (Próximos 7 días)</h3>
        <div class="relative bg-white rounded-lg shadow-md p-6">
            <canvas id="weeklyFeedChart" style="height: 400px;"></canvas>
        </div>
    </div>

    <!-- Tabla de predicciones -->
    <div class="mb-8">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Detalle de Predicciones</h3>
        <div class="overflow-x-auto">
            <table class="min-w-full bg-white border border-gray-200 shadow-md rounded-lg overflow-hidden text-center">
                <thead class="bg-gray-700 text-white">
                    <tr>
                        <th class="py-2 px-4">Fecha</th>
                        <th class="py-2 px-4">Comida (kg)</th>
                        <th class="py-2 px-4">Agua (litros)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for prediction in weekly_predictions %}
                    <tr class="border-t hover:bg-gray-100">
                        <td class="py-2 px-4">{{ prediction.date }}</td>
                        <td class="py-2 px-4">{{ prediction.food }}</td>
                        <td class="py-2 px-4">{{ prediction.water }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Gráfico de barras para consumo semanal
    const ctx = document.getElementById('weeklyFeedChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ prediction_dates|safe }},
            datasets: [
                {
                    label: 'Comida (kg)',
                    data: {{ food_predictions|safe }},
                    backgroundColor: '#FF6384',
                },
                {
                    label: 'Agua (litros)',
                    data: {{ water_predictions|safe }},
                    backgroundColor: '#36A2EB',
                },
            ],
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                },
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Días',
                    },
                },
                y: {
                    title: {
                        display: true,
                        text: 'Cantidad',
                    },
                },
            },
        },
    });
</script>

{% endblock %}
